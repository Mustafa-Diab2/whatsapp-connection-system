# Railway Configuration
# لنشر Backend على Railway

# ⚠️ مهم: لحفظ WhatsApp Sessions بين deployments
# في Railway Dashboard:
# 1. اذهب إلى Settings → Volumes
# 2. أضف Volume جديد:
#    - Mount Path: /app/.wwebjs_auth
#    - Size: 1 GB (كافية)
# 3. عند Redeploy، الجلسات ستبقى محفوظة

[build]
builder = "NIXPACKS"
buildCommand = "cd apps/api && npm install --include=dev && npm run build"

[deploy]
startCommand = "cd apps/api && npm start"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

[deploy.env]
# Let Puppeteer download its own Chromium

[nixpacks]
aptPkgs = ["chromium", "chromium-sandbox", "ca-certificates", "fonts-liberation", "libgbm1", "libnss3", "libatk-bridge2.0-0", "libdrm2", "libxkbcommon0", "libxcomposite1", "libxdamage1", "libxfixes3", "libxrandr2", "libcups2", "libasound2", "libx11-xcb1", "libxcb1"]

[nixpacks.phases.setup]
nixPkgs = ["chromium"]
