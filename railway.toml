# Railway Configuration
# لنشر Backend على Railway

[build]
builder = "NIXPACKS"
buildCommand = "cd apps/api && npm install --include=dev && npm run build"

[deploy]
startCommand = "cd apps/api && npm start"
healthcheckPath = "/health"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[deploy.env]
PUPPETEER_SKIP_CHROMIUM_DOWNLOAD = "true"
PUPPETEER_EXECUTABLE_PATH = "/usr/bin/chromium"

[nixpacks]
aptPkgs = ["chromium", "chromium-sandbox", "ca-certificates", "fonts-liberation", "libgbm1", "libnss3", "libatk-bridge2.0-0", "libdrm2", "libxkbcommon0", "libxcomposite1", "libxdamage1", "libxfixes3", "libxrandr2", "libcups2", "libasound2", "libx11-xcb1", "libxcb1"]

[nixpacks.phases.setup]
nixPkgs = ["chromium"]
